
<blockquote>
  <p><strong>Note: Riak Search preferred for querying</strong></p>

  <p>If you’re interested in non-primary-key-based querying in Riak, i.e. if
you’re looking to go beyond straightforward K/V operations, we now
recommend <a href="/riak/kv/2.2.0/developing/usage/search/">Riak Search</a> rather than secondary indexes for
a variety of reasons. Most importantly, Riak Search has a far more
capacious querying API and can be used with all of Riak’s storage
backends.</p>
</blockquote>

<p>Secondary indexes (2i) in Riak enable you to tag objects stored in Riak,
at write time, with one or more queryable values. Those values can then
be used to find multiple objects in Riak. If you’re storing <a href="/riak/kv/2.2.0/developing/data-modeling/#user-accounts">user data</a>, for example, you could tag each object
associated with that user with a username or other unique marker. Once
tagged, you could find all objects in a Riak bucket sharing that tag.
Secondary indexes can be either a binary or string, such as
<code class="language-plaintext highlighter-rouge">sensor_1_data</code> or <code class="language-plaintext highlighter-rouge">admin_user</code> or <code class="language-plaintext highlighter-rouge">click_event</code>, or an integer, such as
<code class="language-plaintext highlighter-rouge">99</code> or <code class="language-plaintext highlighter-rouge">141121</code>.</p>

<p><a href="/riak/kv/2.2.0/developing/usage/search/">Riak Search</a> serves analogous purposes but is quite
different because it parses key/value data itself and builds indexes on
the basis of Solr schemas.</p>

<p>Please note that 2i can be used only with the <a href="/riak/kv/2.2.0/setup/planning/backend/leveldb">LevelDB</a> and <a href="/riak/kv/2.2.0/setup/planning/backend/memory">Memory</a>
backends.</p>

<h2 id="features">Features</h2>

<ul>
  <li>Allows two types of secondary attributes: integers and strings (aka
binaries)</li>
  <li>Allows querying by exact match or range on one index</li>
  <li>Allows pagination of results</li>
  <li>Allows streaming of results</li>
  <li>Query results can be used as input to a <a href="/riak/kv/2.2.0/developing/usage/mapreduce/">MapReduce</a>
query</li>
</ul>

<blockquote>
  <p><strong>Note on 2i and strong consistency</strong>
Secondary indexes do not currently work with the <a href="/riak/kv/2.2.0/using/reference/strong-consistency">strong consistency</a>
feature introduced in Riak version 2.0. If you store objects in
<a href="/riak/kv/2.2.0/developing/app-guide/strong-consistency/#creating-a-strongly-consistent-bucket-type">strongly consistent buckets</a> and attach
secondary index metadata to those objects, you can still perform
strongly consistent operations on those objects but the secondary
indexes will be ignored.</p>
</blockquote>

<h2 id="when-to-use-secondary-indexes">When to Use Secondary Indexes</h2>

<p>Secondary indexes are useful when you want to find data on the basis of
something other than objects’ bucket type, bucket, and key, i.e. when
you want objects to be discoverable based on more than their location
alone.</p>

<p>2i works best for objects whose value is stored in an opaque blob, like
a binary file, because those objects don’t offer any clues that enable
you to discover them later. Indexing enables you to tag those objects
and find all objects with the same tag in a specified bucket later on.</p>

<p>2i is thus recommended when your use case requires an easy-to-use search
mechanism that does not require a schema (as does <a href="/riak/kv/2.2.0/using/reference/search/#schemas">Riak Search</a>) and a basic query interface, i.e. an interface that
enables an application to tell Riak things like “fetch all objects
tagged with the string <code class="language-plaintext highlighter-rouge">Milwaukee_Bucks</code>” or “fetch all objects tagged
with numbers between 1500 and 1509.”</p>

<p>2i is also recommended if your use case requires anti-entropy. Since
secondary indexes are just metadata attached to key/value objects, 2i
piggybacks off of read-repair.</p>

<h2 id="when-not-to-use-secondary-indexes">When Not to Use Secondary Indexes</h2>

<ul>
  <li>If your ring size exceeds 512 partitions, 2i can cause performance
issues in large clusters.</li>
  <li>When you need more than the exact match and range searches that 2i
supports. If that’s the case, we recommend checking out <a href="/riak/kv/2.2.0/developing/usage/search/">Riak Search</a>.</li>
  <li>When you want to use composite queries. A query like
<code class="language-plaintext highlighter-rouge">last_name=zezeski AND state=MD</code> would have to be split into two
queries and the results merged (or it would need to involve
<a href="/riak/kv/2.2.0/developing/usage/mapreduce/">MapReduce</a>).</li>
</ul>

<h2 id="query-interfaces-and-examples">Query Interfaces and Examples</h2>

<p>Typically, the result set from a 2i query is a list of object keys from
the specified bucket that include the index values in question. As we’ll
see below, when executing range queries in Riak 1.4 or higher, it is
possible to retrieve the index values along with the object keys.</p>

<h3 id="inserting-objects-with-secondary-indexes">Inserting Objects with Secondary Indexes</h3>

<p>In this example, the key <code class="language-plaintext highlighter-rouge">john_smith</code> is used to store user data in the
bucket <code class="language-plaintext highlighter-rouge">users</code>, which bears the <code class="language-plaintext highlighter-rouge">default</code> bucket type. Let’s say that an
application would like add a Twitter handle and an email address to this
object as secondary indexes.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Location</span> <span class="n">johnSmithKey</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Location</span><span class="o">(</span><span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"default"</span><span class="o">,</span> <span class="s">"users"</span><span class="o">),</span> <span class="s">"john_smith"</span><span class="o">);</span>

<span class="c1">// In the Java client (and all clients), if you do not specify a bucket type,</span>
<span class="c1">// the client will use the default type. And so the following store command</span>
<span class="c1">// would be equivalent to the one above:</span>
<span class="nc">Location</span> <span class="n">johnSmithKey</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Location</span><span class="o">(</span><span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"users"</span><span class="o">),</span> <span class="s">"john_smith"</span><span class="o">);</span>

<span class="nc">RiakObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RiakObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="nc">BinaryValue</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"{'user_data':{ ... }}"</span><span class="o">));</span>

<span class="n">obj</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">StringBinIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"twitter"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="s">"jsmith123"</span><span class="o">);</span>
<span class="n">obj</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">StringBinIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"email"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="s">"jsmith@basho.com"</span><span class="o">);</span>

<span class="nc">StoreValue</span> <span class="n">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StoreValue</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">obj</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withLocation</span><span class="o">(</span><span class="n">johnSmithKey</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">store</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'default'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">RObject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">'john_smith'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s1">'application/json'</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">raw_data</span> <span class="o">=</span> <span class="s1">'{"user_data":{ ... }}'</span>

<span class="c1"># String/binary indexes must be set as an array of strings</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'twitter_bin'</span><span class="p">]</span> <span class="o">=</span> <span class="sx">%w{ jsmith123 }</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'email_bin'</span><span class="p">]</span> <span class="o">=</span> <span class="sx">%w{ jsmith@basho.com }</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">store</span>

<span class="c1"># In the Ruby client (and all clients), if you do not specify a bucket</span>
<span class="c1"># type, the client will use the default type. And so the following set</span>
<span class="c1"># of commands would be equivalent to the one above:</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
<span class="c1"># repeat the same commands for building the object</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">store</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Object</span><span class="p">(</span><span class="s1">'{"user_data":{ ... }}'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'twitter_bin'</span><span class="p">,</span> <span class="s1">'jsmith123'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'email_bin'</span><span class="p">,</span> <span class="s1">'jsmith@basho.com'</span><span class="p">);</span>

<span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\StoreObject</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">withObject</span><span class="p">(</span><span class="nv">$object</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">buildLocation</span><span class="p">(</span><span class="s1">'john_smith'</span><span class="p">,</span> <span class="s1">'users'</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'default'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span>
<span class="c1"># In the Python client (and all clients), if you do not specify a bucket type,
# the client will use the default type. And so the following store command
# would be equivalent to the one above:
</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">RiakObject</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="s">'john_smith'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s">'text/plain'</span>
<span class="n">obj</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">'...user data...'</span>
<span class="n">obj</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'twitter_bin'</span><span class="p">,</span> <span class="s">'jsmith123'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'email_bin'</span><span class="p">,</span> <span class="s">'jsmith@basho.com'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="n">store</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">id</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObjectId</span><span class="p">(</span><span class="s">"default"</span><span class="p">,</span> <span class="s">"users"</span><span class="p">,</span> <span class="s">"john_smith"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObject</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">"...user data..."</span><span class="p">,</span>
    <span class="n">RiakConstants</span><span class="p">.</span><span class="n">ContentTypes</span><span class="p">.</span><span class="n">TextPlain</span><span class="p">);</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">BinIndex</span><span class="p">(</span><span class="s">"twitter"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="s">"jsmith123"</span><span class="p">);</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">BinIndex</span><span class="p">(</span><span class="s">"email"</span><span class="p">).</span><span class="n">Set</span><span class="s">"jsmith@basho.com"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">rslt</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">riakObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">RiakObject</span><span class="p">();</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setContentType</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">john_smith</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">...user data...</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">twitter_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">jsmith123</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">email_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">jsmith@basho.com</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">storeValue</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="nx">riakObj</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Obj</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">({</span><span class="o">&lt;&lt;</span><span class="s">"default"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"users"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
                    <span class="o">&lt;&lt;</span><span class="s">"john_smith"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
                    <span class="o">&lt;&lt;</span><span class="s">"...user data..."</span><span class="o">&gt;&gt;</span><span class="p">,</span>
                    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span><span class="p">),</span>
<span class="c">%% In the Erlang client (and all clients), if you do not specify a bucket type,
%% the client will use the default type. And so the following object would be
%% equivalent to the one above:
</span>
<span class="nv">Obj</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">"users"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
                    <span class="o">&lt;&lt;</span><span class="s">"john_smith"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
                    <span class="o">&lt;&lt;</span><span class="s">"...user data..."</span><span class="o">&gt;&gt;</span><span class="p">,</span>
                    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span><span class="p">),</span>
<span class="nv">MD1</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">get_update_metadata</span><span class="p">(</span><span class="nv">Obj</span><span class="p">),</span>
<span class="nv">MD2</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span>
    <span class="nv">MD1</span><span class="p">,</span>
    <span class="p">[</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"twitter"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"jsmith123"</span><span class="o">&gt;&gt;</span><span class="p">]},</span>
     <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"email"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"jsmith@basho.com"</span><span class="o">&gt;&gt;</span><span class="p">]}]),</span>
<span class="nv">Obj2</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">update_metadata</span><span class="p">(</span><span class="nv">Obj</span><span class="p">,</span> <span class="nv">MD2</span><span class="p">),</span>
<span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nb">put</span><span class="p">(</span><span class="nv">Pid</span><span class="p">,</span> <span class="nv">Obj2</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">obj</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">riak</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span>
    <span class="n">ContentType</span><span class="o">:</span>     <span class="s">"text/plain"</span><span class="p">,</span>
    <span class="n">Charset</span><span class="o">:</span>         <span class="s">"utf-8"</span><span class="p">,</span>
    <span class="n">ContentEncoding</span><span class="o">:</span> <span class="s">"utf-8"</span><span class="p">,</span>
    <span class="n">BucketType</span><span class="o">:</span>      <span class="s">"indexes"</span><span class="p">,</span>
    <span class="n">Bucket</span><span class="o">:</span>          <span class="s">"users"</span><span class="p">,</span>
    <span class="n">Key</span><span class="o">:</span>             <span class="s">"john_smith"</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">:</span>           <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"…user data…"</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">obj</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"twitter_bin"</span><span class="p">,</span> <span class="s">"jsmith123"</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"email_bin"</span><span class="p">,</span> <span class="s">"jsmith@basho.com"</span><span class="p">)</span>

<span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewStoreValueCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithContent</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl -XPOST localhost:8098/types/default/buckets/users/keys/john_smith \
  -H 'x-riak-index-twitter_bin: jsmith123' \
  -H 'x-riak-index-email_bin: jsmith@basho.com' \
  -H 'Content-Type: application/json' \
  -d '{"userData":"data"}'
</code></pre>

<blockquote>
  <p><strong>Getting started with Riak clients</strong></p>

  <p>If you are connecting to Riak using one of Basho’s official <a href="/riak/kv/2.2.0/developing/client-libraries">client libraries</a>, you can find more information about getting started with
your client in the <a href="/riak/kv/2.2.0/developing/getting-started">Developing with Riak KV: Getting Started</a> section.</p>
</blockquote>

<p>This has accomplished the following:</p>

<ul>
  <li>The object has been stored with a primary bucket/key of
<code class="language-plaintext highlighter-rouge">users</code>/<code class="language-plaintext highlighter-rouge">john_smith</code></li>
  <li>The object now has a secondary index called <code class="language-plaintext highlighter-rouge">twitter_bin</code> with a value
of <code class="language-plaintext highlighter-rouge">jsmith123</code></li>
  <li>The object now has a secondary index called <code class="language-plaintext highlighter-rouge">email_bin</code> with a value
of <code class="language-plaintext highlighter-rouge">jsmith@basho.com</code></li>
</ul>

<h3 id="querying-objects-with-secondary-indexes">Querying Objects with Secondary Indexes</h3>

<p>Let’s query the <code class="language-plaintext highlighter-rouge">users</code> bucket on the basis of Twitter handle to make
sure that we can find our stored object:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">usersBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"users"</span><span class="o">);</span>
<span class="nc">BinIndexQuery</span> <span class="n">biq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">usersBucket</span><span class="o">,</span> <span class="s">"twitter"</span><span class="o">,</span> <span class="s">"jsmith123"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">biq</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span><span class="o">.</span><span class="na">Entry</span><span class="o">&gt;</span> <span class="n">entries</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntries</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span><span class="o">.</span><span class="na">Entry</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">entries</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getRiakObjectLocation</span><span class="o">().</span><span class="na">getKey</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'twitter_bin'</span><span class="p">,</span> <span class="s1">'jsmith123'</span><span class="p">)</span>

<span class="c1"># This is equivalent to the following:</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'default'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'twitter_bin'</span><span class="p">,</span> <span class="s1">'jsmith123'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$response</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'twitter_bin'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withScalarValue</span><span class="p">(</span><span class="s1">'jsmith123'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket</span><span class="p">(</span><span class="s">'users'</span><span class="p">)</span> <span class="c1"># equivalent to client.bucket_type('default').bucket('users')
</span><span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span><span class="s">'twitter_bin'</span><span class="p">,</span> <span class="s">'jsmith123'</span><span class="p">).</span><span class="n">results</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">idxId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"default"</span><span class="p">,</span> <span class="s">"users"</span><span class="p">,</span> <span class="s">"twitter"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">rslt</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">idxId</span><span class="p">,</span> <span class="s">"jsmith123"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">idxRslt</span> <span class="p">=</span> <span class="n">rslt</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">keyTerm</span> <span class="k">in</span> <span class="n">idxRslt</span><span class="p">.</span><span class="n">IndexKeyTerms</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">keyTerm</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">query_keys</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">function</span> <span class="nx">query_cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">rslt</span><span class="p">.</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">query_keys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">"</span><span class="s2">2i query key: '%s'</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">rslt</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">query_keys</span><span class="p">,</span>
            <span class="nx">rslt</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">objectKey</span><span class="p">;</span>
            <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">twitter_bin</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">jsmith123</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">cmd</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span>
    <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index</span><span class="p">(</span><span class="nv">Pid</span><span class="p">,</span>
                              <span class="o">&lt;&lt;</span><span class="s">"users"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="c">%% bucket
</span>                              <span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"twitter"</span><span class="p">},</span> <span class="c">%% index name
</span>                              <span class="o">&lt;&lt;</span><span class="s">"jsmith123"</span><span class="o">&gt;&gt;</span><span class="p">).</span> <span class="c">%% index
</span></code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"users"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"twitter_bin"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexKey</span><span class="p">(</span><span class="s">"jsmith123"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/buckets/users/index/twitter_bin/jsmith123
</code></pre>

<p>The response:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">john_smith</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s2">"john_smith"</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s1">'john_smith'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s">'john_smith'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">john_smith</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">john_smith</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,{</span><span class="n">index_results_v1</span><span class="p">,[</span><span class="o">&lt;&lt;</span><span class="s">"john_smith"</span><span class="o">&gt;&gt;</span><span class="p">],</span>
                      <span class="n">undefined</span><span class="p">,</span><span class="n">undefined</span><span class="p">}}.</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">john_smith</span>
</code></pre></div></div>

<pre><code class="language-curl">{
  "keys": [
    "john_smith"
  ]
}
</code></pre>

<h2 id="examples">Examples</h2>

<p>To run the following examples, make sure that Riak is configured to use
an index-capable storage backend, such as <a href="/riak/kv/2.2.0/setup/planning/backend/leveldb">LevelDB</a> or <a href="/riak/kv/2.2.0/setup/planning/backend/memory">Memory</a>.</p>

<h2 id="indexing-objects">Indexing Objects</h2>

<p>The following example indexes four different objects. Notice that we’re
storing both integer and string (aka binary) fields. Field names are
automatically lowercased, some fields have multiple values, and
duplicate fields are automatically de-duplicated, as in the following
example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">peopleBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"people"</span><span class="o">);</span>

<span class="nc">RiakObject</span> <span class="n">larry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RiakObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="nc">BinaryValue</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"My name is Larry"</span><span class="o">));</span>
<span class="n">larry</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">StringBinIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"field1"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="s">"val1"</span><span class="o">);</span>
<span class="n">larry</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">LongIntIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"field2"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="mi">1001L</span><span class="o">);</span>
<span class="nc">StoreValue</span> <span class="n">storeLarry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StoreValue</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">larry</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withLocation</span><span class="o">(</span><span class="n">peopleBucket</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="s">"larry"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">storeLarry</span><span class="o">);</span>

<span class="nc">RiakObject</span> <span class="n">moe</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RiakObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="nc">BinaryValue</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Ny name is Moe"</span><span class="o">));</span>
<span class="n">moe</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">StringBinIdex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"Field1"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="s">"val2"</span><span class="o">);</span>
<span class="n">moe</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">LongIntIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"Field2"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="mi">1002L</span><span class="o">);</span>
<span class="nc">StoreValue</span> <span class="n">storeMoe</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StoreValue</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">moe</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withLocation</span><span class="o">(</span><span class="n">peopleBucket</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="s">"moe"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">storeMoe</span><span class="o">);</span>

<span class="nc">RiakObject</span> <span class="n">curly</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RiakObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="nc">BinaryValue</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"My name is Curly"</span><span class="o">));</span>
<span class="n">curly</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">StringBinIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"FIELD1"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="s">"val3"</span><span class="o">);</span>
<span class="n">curly</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">LongIntIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"FIELD2"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="mi">1003L</span><span class="o">);</span>
<span class="nc">StoreValue</span> <span class="n">storeCurly</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StoreValue</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">curly</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withLocation</span><span class="o">(</span><span class="n">peopleBucket</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="s">"curly"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">storeCurly</span><span class="o">);</span>

<span class="nc">RiakObject</span> <span class="n">veronica</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RiakObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="nc">BinaryValue</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"My name is Veronica"</span><span class="o">));</span>
<span class="n">veronica</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">StringBinIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"field1"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"val4"</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="s">"val4"</span><span class="o">);</span>
<span class="n">veronica</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">LongIntIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"field2"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1004L</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="mi">1005L</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="mi">1006L</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="mi">1004L</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="mi">1004L</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="mi">1007L</span><span class="o">);</span>
<span class="nc">StoreValue</span> <span class="n">storeVeronica</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StoreValue</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">veronica</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withLocation</span><span class="o">(</span><span class="n">peopleBucket</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="s">"veronica"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">storeVeronica</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>

<span class="n">obj1</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">RObject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">'larry'</span><span class="p">)</span>
<span class="n">obj1</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s1">'text/plain'</span>
<span class="n">obj1</span><span class="p">.</span><span class="nf">raw_data</span> <span class="o">=</span> <span class="s1">'My name is Larry'</span>
<span class="n">obj1</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field1_bin'</span><span class="p">]</span> <span class="o">=</span> <span class="sx">%w{ val1 }</span>
<span class="c1"># Like binary/string indexes, integer indexes must be set as an array,</span>
<span class="c1"># even if you wish to add only a single index</span>
<span class="n">obj1</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1001</span><span class="p">]</span>
<span class="n">obj1</span><span class="p">.</span><span class="nf">store</span>

<span class="n">obj2</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">RObject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">'moe'</span><span class="p">)</span>
<span class="n">obj2</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s1">'text/plain'</span>
<span class="n">obj2</span><span class="p">.</span><span class="nf">raw_data</span> <span class="o">=</span> <span class="s1">'My name is Larry'</span>
<span class="n">obj2</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'Field1_bin'</span><span class="p">]</span> <span class="o">=</span> <span class="sx">%w{ val2 }</span>
<span class="n">obj2</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'Field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1002</span><span class="p">]</span>
<span class="n">obj2</span><span class="p">.</span><span class="nf">store</span>

<span class="n">obj3</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">RObject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">'curly'</span><span class="p">)</span>
<span class="n">obj3</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s1">'text/plain'</span>
<span class="n">obj3</span><span class="p">.</span><span class="nf">raw_data</span> <span class="o">=</span> <span class="s1">'My name is Curly'</span>
<span class="n">obj3</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'FIELD1_BIN'</span><span class="p">]</span> <span class="o">=</span> <span class="sx">%w{ val3 }</span>
<span class="n">obj3</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'FIELD2_INT'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1003</span><span class="p">]</span>
<span class="n">obj3</span><span class="p">.</span><span class="nf">store</span>

<span class="n">obj4</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">RObject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">'veronica'</span><span class="p">)</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s1">'text/plain'</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">raw_data</span> <span class="o">=</span> <span class="s1">'My name is Veronica'</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field1_bin'</span><span class="p">]</span> <span class="o">=</span> <span class="sx">%w{ val4 val4 val4a val4b }</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1004</span><span class="p">,</span> <span class="mi">1004</span><span class="p">,</span> <span class="mi">1005</span><span class="p">,</span> <span class="mi">1006</span><span class="p">]</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1004</span><span class="p">]</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1004</span><span class="p">]</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1004</span><span class="p">]</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1007</span><span class="p">]</span>
<span class="n">obj4</span><span class="p">.</span><span class="nf">store</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$bucket</span> <span class="o">=</span> <span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">);</span>

<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nc">Basho\Riak\Object</span><span class="s1">'My name is Larry'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">,</span> <span class="s1">'val1'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1001</span><span class="p">);</span>

<span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\StoreObject</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">withObject</span><span class="p">(</span><span class="nv">$object</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withLocation</span><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Location</span><span class="p">(</span><span class="s1">'larry'</span><span class="p">,</span> <span class="nv">$bucket</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nc">Basho\Riak\Object</span><span class="s1">'My name is Moe'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'Field1_bin'</span><span class="p">,</span> <span class="s1">'val2'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'Field2_int'</span><span class="p">,</span> <span class="mi">1002</span><span class="p">);</span>

<span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\StoreObject</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">withObject</span><span class="p">(</span><span class="nv">$object</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withLocation</span><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Location</span><span class="p">(</span><span class="s1">'moe'</span><span class="p">,</span> <span class="nv">$bucket</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nc">Basho\Riak\Object</span><span class="s1">'My name is Curly'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'FIELD1_BIN'</span><span class="p">,</span> <span class="s1">'val3'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'FIELD2_int'</span><span class="p">,</span> <span class="mi">1003</span><span class="p">);</span>

<span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\StoreObject</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">withObject</span><span class="p">(</span><span class="nv">$object</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withLocation</span><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Location</span><span class="p">(</span><span class="s1">'curly'</span><span class="p">,</span> <span class="nv">$bucket</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nc">Basho\Riak\Object</span><span class="s1">'My name is Veronica'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">,</span> <span class="s1">'val4'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">,</span> <span class="s1">'val4'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">,</span> <span class="s1">'val4a'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">,</span> <span class="s1">'val4b'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1005</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1006</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1007</span><span class="p">);</span>

<span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\StoreObject</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">withObject</span><span class="p">(</span><span class="nv">$object</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withLocation</span><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Location</span><span class="p">(</span><span class="s1">'veronica'</span><span class="p">,</span> <span class="nv">$bucket</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>

<span class="n">obj1</span> <span class="o">=</span> <span class="n">RiakObject</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="s">'larry'</span><span class="p">)</span>
<span class="n">obj1</span><span class="p">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s">'text/plain'</span>
<span class="n">obj1</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">'My name is Larry'</span>
<span class="n">obj1</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field1_bin'</span><span class="p">,</span> <span class="s">'val1'</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">obj1</span><span class="p">.</span><span class="n">store</span><span class="p">()</span>

<span class="n">obj2</span> <span class="o">=</span> <span class="n">RiakObject</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="s">'moe'</span><span class="p">)</span>
<span class="n">obj2</span><span class="p">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s">'text/plain'</span>
<span class="n">obj2data</span> <span class="o">=</span> <span class="s">'Moe'</span>
<span class="n">obj2</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'Field1_bin'</span><span class="p">,</span> <span class="s">'val2'</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'Field2_int'</span><span class="p">,</span> <span class="mi">1002</span><span class="p">)</span>
<span class="n">obj2</span><span class="p">.</span><span class="n">store</span><span class="p">()</span>

<span class="n">obj3</span> <span class="o">=</span> <span class="n">RiakObject</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="s">'curly'</span><span class="p">)</span>
<span class="n">obj3</span><span class="p">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s">'text/plain'</span>
<span class="n">obj3</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">'Curly'</span>
<span class="n">obj3</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'FIELD1_BIN'</span><span class="p">,</span> <span class="s">'val3'</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'FIELD2_INT'</span><span class="p">,</span> <span class="mi">1003</span><span class="p">)</span>
<span class="n">obj3</span><span class="p">.</span><span class="n">store</span><span class="p">()</span>

<span class="n">obj4</span> <span class="o">=</span> <span class="n">RiakObject</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="s">'veronica'</span><span class="p">)</span>
<span class="n">obj4</span><span class="p">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s">'text/plain'</span>
<span class="n">obj4</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">'Veronica'</span>
<span class="n">obj4</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field1_bin'</span><span class="p">,</span> <span class="s">'val4'</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field1_bin'</span><span class="p">,</span> <span class="s">'val4a'</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field1_bin'</span><span class="p">,</span> <span class="s">'val4b'</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1005</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1006</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">).</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1007</span><span class="p">)</span>
<span class="n">obj4</span><span class="p">.</span><span class="n">store</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">larryId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObjectId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"larry"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">larry</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObject</span><span class="p">(</span><span class="n">larryId</span><span class="p">,</span> <span class="s">"My name is Larry"</span><span class="p">,</span>
    <span class="n">RiakConstants</span><span class="p">.</span><span class="n">ContentTypes</span><span class="p">.</span><span class="n">TextPlain</span><span class="p">);</span>

<span class="n">larry</span><span class="p">.</span><span class="nf">BinIndex</span><span class="p">(</span><span class="s">"field1"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="s">"val1"</span><span class="p">);</span>
<span class="n">larry</span><span class="p">.</span><span class="nf">IntIndex</span><span class="p">(</span><span class="s">"field2"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="m">1001</span><span class="p">);</span>

<span class="n">client</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="n">larry</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">moeId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObjectId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"moe"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">moe</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObject</span><span class="p">(</span><span class="n">moeId</span><span class="p">,</span> <span class="s">"My name is Moe"</span><span class="p">,</span>
    <span class="n">RiakConstants</span><span class="p">.</span><span class="n">ContentTypes</span><span class="p">.</span><span class="n">TextPlain</span><span class="p">);</span>

<span class="n">moe</span><span class="p">.</span><span class="nf">BinIndex</span><span class="p">(</span><span class="s">"Field1"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="s">"val2"</span><span class="p">);</span>
<span class="n">moe</span><span class="p">.</span><span class="nf">IntIndex</span><span class="p">(</span><span class="s">"Field2"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="m">1002</span><span class="p">);</span>

<span class="n">client</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="n">moe</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">curlyId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObjectId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"curly"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">curly</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObject</span><span class="p">(</span><span class="n">curlyId</span><span class="p">,</span> <span class="s">"My name is Curly"</span><span class="p">,</span>
    <span class="n">RiakConstants</span><span class="p">.</span><span class="n">ContentTypes</span><span class="p">.</span><span class="n">TextPlain</span><span class="p">);</span>

<span class="n">curly</span><span class="p">.</span><span class="nf">BinIndex</span><span class="p">(</span><span class="s">"FIELD1"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="s">"val3"</span><span class="p">);</span>
<span class="n">curly</span><span class="p">.</span><span class="nf">IntIndex</span><span class="p">(</span><span class="s">"FIELD2"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="m">1003</span><span class="p">);</span>

<span class="n">client</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="n">curly</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">veronicaId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObjectId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"veronica"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">veronica</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObject</span><span class="p">(</span><span class="n">veronicaId</span><span class="p">,</span> <span class="s">"My name is Veronica"</span><span class="p">,</span>
    <span class="n">RiakConstants</span><span class="p">.</span><span class="n">ContentTypes</span><span class="p">.</span><span class="n">TextPlain</span><span class="p">);</span>

<span class="n">veronica</span><span class="p">.</span><span class="nf">BinIndex</span><span class="p">(</span><span class="s">"FIELD1"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"val4"</span><span class="p">,</span> <span class="s">"val4a"</span><span class="p">,</span> <span class="s">"val4b"</span> <span class="p">});</span>
<span class="n">veronica</span><span class="p">.</span><span class="nf">IntIndex</span><span class="p">(</span><span class="s">"FIELD2"</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">[]</span> <span class="p">{</span>
    <span class="m">1004</span><span class="p">,</span> <span class="m">1005</span><span class="p">,</span> <span class="m">1006</span><span class="p">,</span> <span class="m">1004</span><span class="p">,</span> <span class="m">1004</span><span class="p">,</span> <span class="m">1007</span>
<span class="p">});</span>

<span class="n">client</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="n">veronica</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">store_cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">,</span> <span class="nx">async_cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">async_cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">storeFuncs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">async_cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">riakObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">RiakObject</span><span class="p">();</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setContentType</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">larry</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">My name is Larry</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">field1_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val1</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">field2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1001</span><span class="p">);</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">storeValue</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="nx">riakObj</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">store_cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">,</span> <span class="nx">async_cb</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">async_cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">riakObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">RiakObject</span><span class="p">();</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setContentType</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">moe</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">My name is Moe</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">Field1_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val2</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">Field2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1002</span><span class="p">);</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">storeValue</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="nx">riakObj</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">store_cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">,</span> <span class="nx">async_cb</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">async_cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">riakObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">RiakObject</span><span class="p">();</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setContentType</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">curly</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">My name is Curly</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD1_BIN</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val3</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD2_INT</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1003</span><span class="p">);</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">storeValue</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="nx">riakObj</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">store_cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">,</span> <span class="nx">async_cb</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">async_cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">riakObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">RiakObject</span><span class="p">();</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setContentType</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">veronica</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">My name is Veronica</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD1_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val4</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD1_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val4</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD1_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val4a</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD1_bin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val4b</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1005</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1006</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1004</span><span class="p">);</span>
        <span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">FIELD2_int</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1007</span><span class="p">);</span>
        <span class="nx">client</span><span class="p">.</span><span class="nx">storeValue</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="nx">riakObj</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">store_cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">,</span> <span class="nx">async_cb</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">];</span>
<span class="k">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">(</span><span class="nx">storeFuncs</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Larry</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
    <span class="o">&lt;&lt;</span><span class="s">"larry"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"My name is Larry"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span><span class="p">),</span>
<span class="nv">LarryMetadata</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">get_update_metadata</span><span class="p">(</span><span class="nv">Larry</span><span class="p">),</span>
<span class="nv">LarryIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span>
    <span class="nv">LarryMetadata</span><span class="p">,</span>
    <span class="p">[</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"val1"</span><span class="o">&gt;&gt;</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1001</span><span class="p">]}]</span>
<span class="p">),</span>
<span class="nv">LarryWithIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">update_metadata</span><span class="p">(</span><span class="nv">Larry</span><span class="p">,</span> <span class="nv">LarryIndexes</span><span class="p">).</span>

<span class="nv">Moe</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
    <span class="o">&lt;&lt;</span><span class="s">"moe"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"My name is Moe"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span><span class="p">),</span>
<span class="nv">MoeMetadata</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">get_update_metadata</span><span class="p">(</span><span class="nv">Moe</span><span class="p">),</span>
<span class="nv">MoeIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span>
    <span class="nv">MoeMetadata</span><span class="p">,</span>
    <span class="p">[</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"Field1"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"val2"</span><span class="o">&gt;&gt;</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"Field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1002</span><span class="p">]}]</span>
<span class="p">),</span>
<span class="nv">MoeWithIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">update_metadata</span><span class="p">(</span><span class="nv">Moe</span><span class="p">,</span> <span class="nv">MoeIndexes</span><span class="p">).</span>

<span class="nv">Curly</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
    <span class="o">&lt;&lt;</span><span class="s">"curly"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"My name is Curly"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span><span class="p">),</span>
<span class="nv">CurlyMetadata</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">get_update_metadata</span><span class="p">(</span><span class="nv">Curly</span><span class="p">),</span>
<span class="nv">CurlyIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span>
    <span class="nv">CurlyMetadata</span><span class="p">,</span>
    <span class="p">[</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"FIELD1"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"val3"</span><span class="o">&gt;&gt;</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"FIELD2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1003</span><span class="p">]}]</span>
<span class="p">),</span>
<span class="nv">CurlyWithIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">update_metadata</span><span class="p">(</span><span class="nv">Curly</span><span class="p">,</span> <span class="nv">CurlyIndexes</span><span class="p">).</span>

<span class="nv">Veronica</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
    <span class="o">&lt;&lt;</span><span class="s">"veronica"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"My name is Veronica"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span><span class="p">),</span>
<span class="nv">VeronicaMetadata</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">get_update_metadata</span><span class="p">(</span><span class="nv">Veronica</span><span class="p">),</span>
<span class="nv">VeronicaIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span>
    <span class="nv">VeronicaMetadata</span><span class="p">,</span>
    <span class="p">[</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"val4"</span><span class="o">&gt;&gt;</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"val4"</span><span class="o">&gt;&gt;</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1004</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1004</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1005</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1006</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1004</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1004</span><span class="p">]},</span> <span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1007</span><span class="p">]}]</span>
<span class="p">),</span>
<span class="nv">VeronicaWithIndexes</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">update_metadata</span><span class="p">(</span><span class="nv">Veronica</span><span class="p">,</span> <span class="nv">VeronicaIndexes</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">o1</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">riak</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span>
    <span class="n">Key</span><span class="o">:</span>   <span class="s">"larry"</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">:</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"My name is Larry"</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">o1</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"field1_bin"</span><span class="p">,</span> <span class="s">"val1"</span><span class="p">)</span>
<span class="n">o1</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"field2_int"</span><span class="p">,</span> <span class="m">1001</span><span class="p">)</span>

<span class="n">o2</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">riak</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span>
    <span class="n">Key</span><span class="o">:</span>   <span class="s">"moe"</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">:</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"My name is Moe"</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">o2</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"Field1_bin"</span><span class="p">,</span> <span class="s">"val2"</span><span class="p">)</span>
<span class="n">o2</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"Field2_int"</span><span class="p">,</span> <span class="m">1002</span><span class="p">)</span>

<span class="n">o3</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">riak</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span>
    <span class="n">Key</span><span class="o">:</span>   <span class="s">"curly"</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">:</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"My name is Curly"</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">o3</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"FIELD1_BIN"</span><span class="p">,</span> <span class="s">"val3"</span><span class="p">)</span>
<span class="n">o3</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"FIELD2_INT"</span><span class="p">,</span> <span class="m">1003</span><span class="p">)</span>

<span class="n">o4</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">riak</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span>
    <span class="n">Key</span><span class="o">:</span>   <span class="s">"veronica"</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">:</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"My name is Veronica"</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"FIELD1_bin"</span><span class="p">,</span> <span class="s">"val4"</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"FIELD1_bin"</span><span class="p">,</span> <span class="s">"val4"</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"FIELD1_bin"</span><span class="p">,</span> <span class="s">"val4a"</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"FIELD1_bin"</span><span class="p">,</span> <span class="s">"val4b"</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"FIELD2_int"</span><span class="p">,</span> <span class="m">1004</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"FIELD2_int"</span><span class="p">,</span> <span class="m">1005</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"FIELD2_int"</span><span class="p">,</span> <span class="m">1006</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"FIELD2_int"</span><span class="p">,</span> <span class="m">1004</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"FIELD2_int"</span><span class="p">,</span> <span class="m">1004</span><span class="p">)</span>
<span class="n">o4</span><span class="o">.</span><span class="n">AddToIntIndex</span><span class="p">(</span><span class="s">"FIELD2_int"</span><span class="p">,</span> <span class="m">1007</span><span class="p">)</span>

<span class="n">objs</span> <span class="o">:=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="n">riak</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span><span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span><span class="p">,</span> <span class="n">o4</span><span class="p">}</span>

<span class="n">wg</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">obj</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">objs</span> <span class="p">{</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">ContentType</span> <span class="o">=</span> <span class="s">"text/plain"</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Charset</span> <span class="o">=</span> <span class="s">"utf-8"</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">ContentEncoding</span> <span class="o">=</span> <span class="s">"utf-8"</span>

    <span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewStoreValueCommandBuilder</span><span class="p">()</span><span class="o">.</span>
        <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
        <span class="n">WithBucket</span><span class="p">(</span><span class="s">"people"</span><span class="p">)</span><span class="o">.</span>
        <span class="n">WithContent</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span>
        <span class="n">Build</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>

    <span class="n">args</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">riak</span><span class="o">.</span><span class="n">Async</span><span class="p">{</span>
        <span class="n">Command</span><span class="o">:</span> <span class="n">cmd</span><span class="p">,</span>
        <span class="n">Wait</span><span class="o">:</span>    <span class="n">wg</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ExecuteAsync</span><span class="p">(</span><span class="n">args</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
</code></pre></div></div>

<pre><code class="language-curl">curl -v -XPUT localhost:8098/types/indexes/buckets/people/keys/larry \
  -H "x-riak-index-field1_bin: val1" \
  -H "x-riak-index-field2_int: 1001" \
  -d 'My name is Larry'

curl -v -XPUT localhost:8098/types/indexes/buckets/people/keys/moe \
  -H "x-riak-index-Field1_bin: val2" \
  -H "x-riak-index-Field2_int: 1002" \
  -d 'My name is Moe'

curl -v -XPUT localhost:8098/types/indexes/buckets/people/keys/curly \
  -H "X-RIAK-INDEX-FIELD1_BIN: val3" \
  -H "X-RIAK-INDEX-FIELD2_INT: 1003" \
  -d 'My name is Curly'

curl -v -XPUT 127.0.0.1:8098/types/indexes/buckets/people/keys/veronica \
  -H "x-riak-index-field1_bin: val4, val4, val4a, val4b" \
  -H "x-riak-index-field2_int: 1004, 1004, 1005, 1006" \
  -H "x-riak-index-field2_int: 1004" \
  -H "x-riak-index-field2_int: 1004" \
  -H "x-riak-index-field2_int: 1004" \
  -H "x-riak-index-field2_int: 1007" \
  -d 'My name is Veronica'
</code></pre>

<p>The above objects will end up having the following secondary indexes,
respectively:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Larry</code> — Binary index <code class="language-plaintext highlighter-rouge">field1_bin</code> and integer index <code class="language-plaintext highlighter-rouge">field2_int</code></li>
  <li><code class="language-plaintext highlighter-rouge">Moe</code> — Binary index <code class="language-plaintext highlighter-rouge">field1_bin</code> and integer index <code class="language-plaintext highlighter-rouge">field2_int</code>
(note that the index names are set to lowercase by Riak)</li>
  <li><code class="language-plaintext highlighter-rouge">Curly</code> — Binary index <code class="language-plaintext highlighter-rouge">field1_bin</code> and integer index <code class="language-plaintext highlighter-rouge">field2_int</code>
(note again that the index names are set to lowercase)</li>
  <li><code class="language-plaintext highlighter-rouge">Veronica</code> — Binary index <code class="language-plaintext highlighter-rouge">field1_bin</code> with the values <code class="language-plaintext highlighter-rouge">val4</code>,
<code class="language-plaintext highlighter-rouge">val4a</code>, and <code class="language-plaintext highlighter-rouge">val4b</code> and integer index <code class="language-plaintext highlighter-rouge">field2_int</code> with the values
<code class="language-plaintext highlighter-rouge">1004</code>, <code class="language-plaintext highlighter-rouge">1005</code>, <code class="language-plaintext highlighter-rouge">1006</code>, and <code class="language-plaintext highlighter-rouge">1007</code> (note that redundancies have been removed)</li>
</ul>

<p>As these examples show, there are safeguards in Riak that both normalize
the names of indexes and prevent the accumulation of redundant indexes.</p>

<h2 id="invalid-field-names-and-types">Invalid Field Names and Types</h2>

<p>The following examples demonstrate what happens when an index field is
specified with an invalid field name or type. The system responds with
<code class="language-plaintext highlighter-rouge">400 Bad Request</code> and a description of the error.</p>

<p>Invalid field name:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The Java client will not allow you to provide invalid index names,</span>
<span class="c1">// because you are not required to add "_bin" or "_int" to the end of</span>
<span class="c1">// those names</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">RObject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">'larry'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_foo'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1001</span><span class="p">]</span>

<span class="c1"># The Ruby client will let you get away with this...at first. But when</span>
<span class="c1"># you attempt to store the object, you will get an error response such</span>
<span class="c1"># as this:</span>

<span class="no">NoMethodError</span><span class="p">:</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="s1">'map'</span> <span class="k">for</span> <span class="mi">1001</span><span class="ss">:Fixnum</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// throws \InvalidArgumentException</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Object</span><span class="p">(</span><span class="s1">'{"user_data":{ ... }}'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'twitter'</span><span class="p">,</span> <span class="s1">'jsmith123'</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">RiakObject</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="s">'larry'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_foo'</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>

<span class="c1"># Result:
</span><span class="n">riak</span><span class="p">.</span><span class="n">RiakError</span><span class="p">:</span> <span class="s">"Riak 2i fields must end with either '_bin' or '_int'."</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The Riak .NET Client will not allow you to provide invalid index names,</span>
<span class="c1">// because you are not required to add "_bin" or "_int" to the end of</span>
<span class="c1">// those names</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">field2_foo</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">jsmith123</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">cmd</span><span class="p">);</span>

<span class="c1">// Produces the following stack trace (truncated):</span>
<span class="nl">error</span><span class="p">:</span> <span class="nx">query_cb</span> <span class="nx">err</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Error processing incoming message: error:function_clause:[{riak_api_pb_server,
    send_error,
    [{unknown_field_type,
        &lt;&lt;"field2_foo"&gt;&gt;},
    {state,
        {gen_tcp,inet},
        #Port&lt;0.68338&gt;,
        undefined,
        ...
        ...
        ...
</span></code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Obj</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
    <span class="o">&lt;&lt;</span><span class="s">"larry"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"some data"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span>
<span class="p">),</span>
<span class="nv">MD1</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">get_update_metadata</span><span class="p">(</span><span class="nv">Obj</span><span class="p">),</span>
<span class="nv">MD2</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span><span class="nv">MD1</span><span class="p">,</span> <span class="p">[</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">foo_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="mi">1001</span><span class="p">]}]).</span>

<span class="c">%% The Erlang client will return an error message along these lines:
</span><span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">no</span> <span class="n">function</span> <span class="n">clause</span> <span class="n">matching</span>
                    <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span> <span class="p">...</span> <span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"users"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"field2_foo"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexKey</span><span class="p">(</span><span class="s">"jsmith123"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"[DevUsing2i] field name error:"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"[DevUsing2i] expected an error!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// Produces the following stack trace (truncated):</span>
<span class="kt">error</span><span class="o">:</span> <span class="n">query_cb</span> <span class="n">err</span><span class="o">:</span> <span class="err">'</span><span class="n">Error</span> <span class="n">processing</span> <span class="n">incoming</span> <span class="n">message</span><span class="o">:</span> <span class="kt">error</span><span class="o">:</span><span class="n">function_clause</span><span class="o">:</span><span class="p">[{</span><span class="n">riak_api_pb_server</span><span class="p">,</span>
    <span class="n">send_error</span><span class="p">,</span>
    <span class="p">[{</span><span class="n">unknown_field_type</span><span class="p">,</span>
        <span class="o">&lt;&lt;</span><span class="s">"field2_foo"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
    <span class="p">{</span><span class="n">state</span><span class="p">,</span>
        <span class="p">{</span><span class="n">gen_tcp</span><span class="p">,</span><span class="n">inet</span><span class="p">},</span>
        <span class="err">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="m">0.68338</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">undefined</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="o">...</span>
        <span class="o">...</span>
</code></pre></div></div>

<pre><code class="language-curl">curl -XPUT 127.0.0.1:8098/types/indexes/buckets/people/keys/larry \
  -H "x-riak-index-field2_foo: 1001" \
  -d 'data1'

# Response
Unknown field type for field: 'field2_foo'.
</code></pre>

<p>Incorrect data type:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Location</span> <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Location</span><span class="o">(</span><span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"people"</span><span class="o">),</span> <span class="s">"larry"</span><span class="o">);</span>
<span class="nc">RiakObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RiakObject</span><span class="o">();</span>
<span class="n">obj</span><span class="o">.</span><span class="na">getIndexes</span><span class="o">().</span><span class="na">getIndex</span><span class="o">(</span><span class="nc">LongIntIndex</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"field2"</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="s">"bar"</span><span class="o">);</span>

<span class="c1">// The Java client will return a response indicating a type mismatch.</span>
<span class="c1">// The output may look something like this:</span>

<span class="nl">Error:</span><span class="o">(</span><span class="mi">46</span><span class="o">,</span> <span class="mi">68</span><span class="o">)</span> <span class="nl">java:</span> <span class="n">no</span> <span class="n">suitable</span> <span class="n">method</span> <span class="n">found</span> <span class="k">for</span> <span class="nf">add</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">)</span>
    <span class="n">method</span> <span class="n">com</span><span class="o">.</span><span class="na">basho</span><span class="o">.</span><span class="na">riak</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">indexes</span><span class="o">.</span><span class="na">RiakIndex</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">)</span> <span class="n">is</span> <span class="n">not</span> <span class="nf">applicable</span>
      <span class="o">(</span><span class="n">argument</span> <span class="n">mismatch</span><span class="o">;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">)</span>
    <span class="n">method</span> <span class="n">com</span><span class="o">.</span><span class="na">basho</span><span class="o">.</span><span class="na">riak</span><span class="o">.</span><span class="na">client</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">indexes</span><span class="o">.</span><span class="na">RiakIndex</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Collection</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">&gt;)</span> <span class="n">is</span> <span class="n">not</span> <span class="nf">applicable</span>
      <span class="o">(</span><span class="n">argument</span> <span class="n">mismatch</span><span class="o">;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Collection</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">&gt;)</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">RObject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s1">'larry'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">indexes</span><span class="p">[</span><span class="s1">'field2_int'</span><span class="p">]</span> <span class="o">=</span> <span class="sx">%w{ bar }</span>

<span class="c1"># The Ruby client will let you get away with this...at first. But when</span>
<span class="c1"># you attempt to store the object, you will get an error response such</span>
<span class="c1"># as this:</span>

<span class="no">NoMethodError</span><span class="p">:</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="s1">'map'</span> <span class="k">for</span> <span class="mi">1001</span><span class="ss">:Fixnum</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// throws \InvalidArgumentException</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Object</span><span class="p">(</span><span class="s1">'{"user_data":{ ... }}'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'twitter_int'</span><span class="p">,</span> <span class="s1">'not_an_int'</span><span class="p">);</span>

<span class="c1">// throws \InvalidArgumentException</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Object</span><span class="p">(</span><span class="s1">'{"user_data":{ ... }}'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'twitter_int'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'arrays'</span><span class="p">,</span> <span class="s1">'are'</span><span class="p">,</span> <span class="s1">'not'</span><span class="p">,</span> <span class="s1">'strings'</span><span class="p">]);</span>

<span class="c1">// does not throw an exception, it will just write ints as a string</span>
<span class="c1">// only requirement is that value is scalar (int, float, string, bool)</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Object</span><span class="p">(</span><span class="s1">'{"user_data":{ ... }}'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'Content-type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">]))</span>
  <span class="o">-&gt;</span><span class="nf">addValueToIndex</span><span class="p">(</span><span class="s1">'twitter_bin'</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">RiakObject</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="s">'larry'</span><span class="p">)</span>
<span class="n">obj</span><span class="p">.</span><span class="n">add_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="s">'bar'</span><span class="p">)</span>

<span class="c1"># The Python client will let you get away with this...at first. But when you
# attempt to store the object, you will get an error response such as this:
</span><span class="n">riak</span><span class="p">.</span><span class="n">RiakError</span><span class="p">:</span> <span class="s">'{precommit_fail,[{field_parsing_failed,{&lt;&lt;"field2_int"&gt;&gt;,&lt;&lt;"bar"&gt;&gt;}}]}'</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">id</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObjectId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"larry"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakObject</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">"test value"</span><span class="p">,</span> <span class="s">"text/plain"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">intIdx</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="nf">IntIndex</span><span class="p">(</span><span class="s">"test-int-idx"</span><span class="p">);</span>
<span class="n">intIdx</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"invalid-value"</span><span class="p">);</span>

<span class="c1">// The .NET client will throw a FormatException at this point</span>
<span class="c1">// The output may look something like this:</span>

<span class="n">The</span> <span class="k">value</span> <span class="n">could</span> <span class="n">not</span> <span class="n">be</span> <span class="n">parsed</span><span class="p">.</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">riakObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">RiakObject</span><span class="p">();</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setContentType</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">setKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">larry</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">riakObj</span><span class="p">.</span><span class="nx">addToIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">field2_int</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">);</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">storeValue</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="nx">riakObj</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">incorrect_data_type err: '%s'</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">incorrect_data_type err: '%s'</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Output:</span>
<span class="nx">buffer</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">67</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="dl">'</span><span class="s1">must start with number, buffer, array or string</span><span class="dl">'</span><span class="p">);</span>
          <span class="o">^</span>
<span class="nx">TypeError</span><span class="p">:</span> <span class="nx">must</span> <span class="nx">start</span> <span class="kd">with</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">array</span> <span class="nx">or</span> <span class="nx">string</span>
    <span class="nx">at</span> <span class="k">new</span> <span class="nx">Buffer</span> <span class="p">(</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">67</span><span class="p">:</span><span class="mi">11</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Obj</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
    <span class="o">&lt;&lt;</span><span class="s">"larry"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"some data"</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="o">&lt;&lt;</span><span class="s">"text/plain"</span><span class="o">&gt;&gt;</span>
<span class="p">),</span>
<span class="nv">MD1</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">get_update_metadata</span><span class="p">(</span><span class="nv">Obj</span><span class="p">),</span>
<span class="nv">MD2</span> <span class="o">=</span> <span class="nn">riakc_obj</span><span class="p">:</span><span class="nf">set_secondary_index</span><span class="p">(</span><span class="nv">MD1</span><span class="p">,</span> <span class="p">[</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="p">[</span><span class="o">&lt;&lt;</span><span class="s">"bar"</span><span class="o">&gt;&gt;</span><span class="p">]}]).</span>

<span class="c">%% The Erlang client will return an error message along these lines:
</span><span class="o">**</span> <span class="n">exception</span> <span class="nn">error</span><span class="p">:</span> <span class="n">bad</span> <span class="n">argument</span>
     <span class="n">in</span> <span class="n">function</span>  <span class="nb">integer_to_list</span><span class="o">/</span><span class="mi">1</span>
        <span class="n">called</span> <span class="n">as</span> <span class="nb">integer_to_list</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">"bar"</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="p">...</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">obj</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">riak</span><span class="o">.</span><span class="n">Object</span><span class="p">{</span>
    <span class="n">BucketType</span><span class="o">:</span>      <span class="s">"indexes"</span><span class="p">,</span>
    <span class="n">Bucket</span><span class="o">:</span>          <span class="s">"people"</span><span class="p">,</span>
    <span class="n">Key</span><span class="o">:</span>             <span class="s">"larry"</span><span class="p">,</span>
    <span class="n">ContentType</span><span class="o">:</span>     <span class="s">"text/plain"</span><span class="p">,</span>
    <span class="n">Charset</span><span class="o">:</span>         <span class="s">"utf-8"</span><span class="p">,</span>
    <span class="n">ContentEncoding</span><span class="o">:</span> <span class="s">"utf-8"</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">:</span>           <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"My name is Larry"</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">obj</span><span class="o">.</span><span class="n">AddToIndex</span><span class="p">(</span><span class="s">"field2_int"</span><span class="p">,</span> <span class="s">"bar"</span><span class="p">)</span>

<span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewStoreValueCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithContent</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"[DevUsing2i] index data type error:"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"[DevUsing2i] expected an error!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// The riak.Error object will contain:</span>
<span class="p">{</span><span class="n">precommit_fail</span><span class="p">,[{</span><span class="n">field_parsing_failed</span><span class="p">,{</span><span class="o">&lt;&lt;</span><span class="s">"field2_int"</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="o">&lt;&lt;</span><span class="s">"bar"</span><span class="o">&gt;&gt;</span><span class="p">}}]}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl -XPUT 127.0.0.1:8098/types/indexes/buckets/people/keys/larry \
  -H "x-riak-index-field2_int: bar" \
  -d 'data1'

# Response
HTTP/1.1 400 Bad Request

Could not parse field 'field2_int', value 'bar'.
</code></pre>

<h2 id="querying">Querying</h2>

<blockquote>
  <p><strong>Note on 2i queries and the R parameter</strong></p>

  <p>For all 2i queries, the <a href="/riak/kv/2.2.0/developing/app-guide/replication-properties#r-value-and-read-failure-tolerance">R</a> parameter is set to 1,
which means that queries that are run while <a href="/riak/kv/2.2.0/learn/glossary/#hinted-handoff">handoffs</a> and related operations are underway may not
return all keys as expected.</p>
</blockquote>

<h3 id="exact-match">Exact Match</h3>

<p>The following examples perform an exact match index query.</p>

<p>Query a binary index:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">myBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"people"</span><span class="o">);</span>
<span class="nc">BinIndexQuery</span> <span class="n">biq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">myBucket</span><span class="o">,</span> <span class="s">"field1"</span><span class="o">,</span> <span class="s">"val1"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">biq</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">,</span> <span class="s1">'val1'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withScalarValue</span><span class="p">(</span><span class="s1">'val1'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span><span class="s">'field1_bin'</span><span class="p">,</span> <span class="s">'val1'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">riakIndexId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">);</span>
<span class="c1">// Note: using a string argument indicates a binary index query:</span>
<span class="kt">var</span> <span class="n">indexRiakResult</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">riakIndexId</span><span class="p">,</span> <span class="s">"val1"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexResult</span> <span class="p">=</span> <span class="n">indexRiakResult</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">binIdxCmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">field1_bin</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">val1</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">binIdxCmd</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span>
    <span class="o">&lt;&lt;</span><span class="s">"val1"</span><span class="o">&gt;&gt;</span>
<span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"people"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"field1_bin"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexKey</span><span class="p">(</span><span class="s">"val1"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/people/index/field1_bin/val1
</code></pre>

<p>Query an integer index:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">myBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"people"</span><span class="o">);</span>
<span class="nc">IntIndexQuery</span> <span class="n">iiq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IntIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">myBucket</span><span class="o">,</span> <span class="s">"field2"</span><span class="o">,</span> <span class="mi">1001L</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">IntIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">iiq</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withScalarValue</span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">riakIndexId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">);</span>
<span class="c1">// Note: using an integer argument indicates an int index query:</span>
<span class="kt">var</span> <span class="n">indexRiakResult</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">riakIndexId</span><span class="p">,</span> <span class="m">1001</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexResult</span> <span class="p">=</span> <span class="n">indexRiakResult</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">intIdxCmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">field2_int</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexKey</span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">intIdxCmd</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span>
    <span class="mi">1001</span>
<span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"people"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"field2_int"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIntIndexKey</span><span class="p">(</span><span class="m">1001</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/people/index/field2_int/1001
</code></pre>

<p>The following example performs an exact match query and pipes the
results into a MapReduce job:</p>

<pre><code class="language-curl">curl -XPOST localhost:8098/mapred \
  -H "Content-Type: application/json" \
  -d @-&lt;&lt;EOF
{
  "inputs": {
    "bucket": "people",
    "index": "field2_bin",
    "key":"val3"
  },
  "query": [
    {
      "reduce": {
        "language":"erlang",
        "module": "riak_kv_mapreduce",
        "function": "reduce_identity",
        "keep": true
      }
    }
  ]
}
EOF
</code></pre>

<h3 id="range">Range</h3>

<p>The following examples perform a range query.</p>

<p>Query a binary index…</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">myBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"people"</span><span class="o">);</span>
<span class="nc">BinIndexQuery</span> <span class="n">biq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">myBucket</span><span class="o">,</span> <span class="s">"field1"</span><span class="o">,</span> <span class="s">"val2"</span><span class="o">,</span> <span class="s">"val4"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">biq</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">,</span> <span class="s1">'val2'</span><span class="o">..</span><span class="s1">'val4'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'field1_bin'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withRangeValue</span><span class="p">(</span><span class="s1">'val2'</span><span class="p">,</span> <span class="s1">'val4'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span><span class="s">'field1_bin'</span><span class="p">,</span> <span class="s">'val2'</span><span class="p">,</span> <span class="s">'val4'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">riakIndexId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexRiakResult</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">riakIndexId</span><span class="p">,</span> <span class="s">"val2"</span><span class="p">,</span> <span class="s">"val4"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexResult</span> <span class="p">=</span> <span class="n">indexRiakResult</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">binIdxCmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">field1_bin</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withRange</span><span class="p">(</span><span class="dl">'</span><span class="s1">val2</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">val4</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">binIdxCmd</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index_range</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">},</span> <span class="c">%% index name
</span>    <span class="o">&lt;&lt;</span><span class="s">"val2"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"val4"</span><span class="o">&gt;&gt;</span> <span class="c">%% range query for keys between "val2" and "val4"
</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"people"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"field1_bin"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithRange</span><span class="p">(</span><span class="s">"val2"</span><span class="p">,</span> <span class="s">"val4"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/people/index/field1_bin/val2/val4
</code></pre>

<p>Or query an integer index…</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">myBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"people"</span><span class="o">);</span>
<span class="nc">IntIndexQuery</span> <span class="n">iiq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IntIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">myBucket</span><span class="o">,</span> <span class="s">"field2"</span><span class="o">,</span> <span class="mi">1002L</span><span class="o">,</span> <span class="mi">1004L</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">IntIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">iiq</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">,</span> <span class="mi">1002</span><span class="o">..</span><span class="mi">1004</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'field2_int'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withRangeValue</span><span class="p">(</span><span class="mi">1002</span><span class="p">,</span> <span class="mi">1004</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span><span class="s">'field2_int'</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="mi">1004</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">riakIndexId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"people"</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexRiakResult</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">riakIndexId</span><span class="p">,</span> <span class="m">1002</span><span class="p">,</span> <span class="m">1004</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexResult</span> <span class="p">=</span> <span class="n">indexRiakResult</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">intIdxCmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">people</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">field2_int</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withRange</span><span class="p">(</span><span class="mi">1002</span><span class="p">,</span> <span class="mi">1004</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">intIdxCmd</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index_range</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">integer_index</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">},</span> <span class="c">%% index name
</span>    <span class="mi">1002</span><span class="p">,</span> <span class="mi">1004</span> <span class="c">%% range query for keys between "val2" and "val4"
</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"people"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"field2_int"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIntRange</span><span class="p">(</span><span class="m">1002</span><span class="p">,</span> <span class="m">1004</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/people/index/field2_int/1002/1004
</code></pre>

<p>The following example performs a range query and pipes the results into
a MapReduce job:</p>

<pre><code class="language-curl">curl -XPOST localhost:8098/mapred\
  -H "Content-Type: application/json" \
  -d @-&lt;&lt;EOF
{
  "inputs": {
    "bucket": "people",
    "index": "field2_bin",
    "start": "1002",
    "end": "1004"
  },
  "query": [
    {
      "reduce": {
        "language": "erlang",
        "module": "riak_kv_mapreduce",
        "function": "reduce_identity",
        "keep": true
      }
    }
  ]
}
EOF
</code></pre>

<h4 id="range-with-terms">Range with terms</h4>

<p>When performing a range query, it is possible to retrieve the matched
index values alongside the Riak keys using <code class="language-plaintext highlighter-rouge">return_terms=true</code>. An
example from a small sampling of Twitter data with indexed hash tags:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">tweetsBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"tweets"</span><span class="o">);</span>
<span class="nc">BinIndexQuery</span> <span class="n">biq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">tweetsBucket</span><span class="o">,</span> <span class="s">"hashtags"</span><span class="o">,</span> <span class="s">"rock"</span><span class="o">,</span> <span class="s">"rocl"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withKeyAndIndex</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">biq</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'hashtags_bin'</span><span class="p">,</span> <span class="s1">'rock'</span><span class="o">..</span><span class="s1">'rocl'</span><span class="p">,</span> <span class="ss">return_terms: </span><span class="kp">true</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'hashtags'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withRangeValue</span><span class="p">(</span><span class="s1">'rock'</span><span class="p">,</span> <span class="s1">'rocl'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withReturnTerms</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'tweets'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span><span class="s">'hashtags_bin'</span><span class="p">,</span> <span class="s">'rock'</span><span class="p">,</span> <span class="s">'rocl'</span><span class="p">,</span> <span class="n">return_terms</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">riakIndexId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"tweets"</span><span class="p">,</span> <span class="s">"hashtags"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexGetOptions</span><span class="p">();</span>
<span class="n">options</span><span class="p">.</span><span class="nf">SetReturnTerms</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexRiakResult</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">riakIndexId</span><span class="p">,</span> <span class="s">"rock"</span><span class="p">,</span> <span class="s">"rocl"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexResult</span> <span class="p">=</span> <span class="n">indexRiakResult</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">binIdxCmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">tweets</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">hashtags_bin</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withRange</span><span class="p">(</span><span class="dl">'</span><span class="s1">rock</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">rocl</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withReturnKeyAndIndex</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">binIdxCmd</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index_range</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"hashtags"</span><span class="p">},</span>     <span class="c">%% index name
</span>    <span class="o">&lt;&lt;</span><span class="s">"rock"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"rocl"</span><span class="o">&gt;&gt;</span>          <span class="c">%% range query for keys between "val2" and "val4"
</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"tweets"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"hashtags_bin"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithRange</span><span class="p">(</span><span class="s">"rock"</span><span class="p">,</span> <span class="s">"rocl"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/tweets/index/hashtags_bin/rock/rocl?return_terms=true
</code></pre>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"rock"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349224101224787968"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"rocks"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349223639880699905"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="pagination">Pagination</h3>

<p>When asking for large result sets, it is often desirable to ask the
servers to return chunks of results instead of a firehose. You can do so
using <code class="language-plaintext highlighter-rouge">max_results=&lt;n&gt;</code>, where <code class="language-plaintext highlighter-rouge">n</code> is the number of results you’d like
to receive.</p>

<p>Assuming more keys are available, a <code class="language-plaintext highlighter-rouge">continuation</code> value will be
included in the results to allow the client to request the next page.</p>

<p>Here is an example of a range query with both <code class="language-plaintext highlighter-rouge">return_terms</code> and
pagination against the same Twitter data set.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">tweetsBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"tweets"</span><span class="o">);</span>
<span class="nc">BinIndexQuery</span> <span class="n">biq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">tweetsBucket</span><span class="o">,</span> <span class="s">"hashtags"</span><span class="o">,</span> <span class="s">"ri"</span><span class="o">,</span> <span class="s">"ru"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withMaxResults</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">biq</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'hashtags_bin'</span><span class="p">,</span> <span class="s1">'ri'</span><span class="o">..</span><span class="s1">'ru'</span><span class="p">,</span> <span class="ss">max_results: </span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'hashtags'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withRangeValue</span><span class="p">(</span><span class="s1">'ri'</span><span class="p">,</span> <span class="s1">'ru'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withMaxResults</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'tweets'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span><span class="s">'hashtags_bin'</span><span class="p">,</span> <span class="s">'ri'</span><span class="p">,</span> <span class="s">'ru'</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">idxId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"tweets"</span><span class="p">,</span> <span class="s">"hashtags"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexGetOptions</span><span class="p">();</span>
<span class="n">options</span><span class="p">.</span><span class="nf">SetMaxResults</span><span class="p">(</span><span class="m">5</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">rslt</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">idxId</span><span class="p">,</span> <span class="s">"ri"</span><span class="p">,</span> <span class="s">"ru"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>

<span class="n">options</span><span class="p">.</span><span class="nf">SetContinuation</span><span class="p">(</span><span class="n">rslt</span><span class="p">.</span><span class="n">Continuation</span><span class="p">);</span>
<span class="n">rslt</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">idxId</span><span class="p">,</span> <span class="s">"ri"</span><span class="p">,</span> <span class="s">"ru"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">do_query</span><span class="p">(</span><span class="nx">continuation</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">binIdxCmdBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">tweets</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">hashtags_bin</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">withRange</span><span class="p">(</span><span class="dl">'</span><span class="s1">ri</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ru</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">withMaxResults</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">pagination_cb</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">continuation</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">binIdxCmdBuilder</span><span class="p">.</span><span class="nx">withContinuation</span><span class="p">(</span><span class="nx">continuation</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">binIdxCmdBuilder</span><span class="p">.</span><span class="nx">build</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">query_keys</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">function</span> <span class="nx">pagination_cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rslt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">query_cb err: '%s'</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">rslt</span><span class="p">.</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">query_keys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="dl">"</span><span class="s2">2i query key: '%s'</span><span class="dl">"</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">query_keys</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">rslt</span><span class="p">.</span><span class="nx">continuation</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">do_query</span><span class="p">(</span><span class="nx">rslt</span><span class="p">.</span><span class="nx">continuation</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">rslt</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">query_keys</span><span class="p">,</span>
            <span class="nx">rslt</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">objectKey</span><span class="p">;</span>
            <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">do_query</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index_range</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"tweets"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"hashtags"</span><span class="p">},</span> <span class="c">%% index name
</span>    <span class="o">&lt;&lt;</span><span class="s">"ri"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"ru"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="c">%% range query from "ri" to "ru"
</span>    <span class="p">{</span><span class="n">max_results</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span>
<span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">doPaginatedQuery</span><span class="p">(</span><span class="n">cluster</span> <span class="o">*</span><span class="n">riak</span><span class="o">.</span><span class="n">Cluster</span><span class="p">,</span> <span class="n">continuation</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="n">builder</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"tweets"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"hashtags_bin"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithRange</span><span class="p">(</span><span class="s">"ri"</span><span class="p">,</span> <span class="s">"ru"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithMaxResults</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">continuation</span> <span class="o">!=</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">continuation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">WithContinuation</span><span class="p">(</span><span class="n">continuation</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">builder</span><span class="o">.</span><span class="n">Build</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
  <span class="p">}</span>

  <span class="n">printIndexQueryResults</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

  <span class="n">sciq</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">riak</span><span class="o">.</span><span class="n">SecondaryIndexQueryCommand</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">sciq</span><span class="o">.</span><span class="n">Response</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"[DevUsing2i] expected response but did not get one"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">rc</span> <span class="o">:=</span> <span class="n">sciq</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">Continuation</span>
  <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">doPaginatedQuery</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">sciq</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">Continuation</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">queryingPagination</span><span class="p">(</span><span class="n">cluster</span> <span class="o">*</span><span class="n">riak</span><span class="o">.</span><span class="n">Cluster</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">doPaginatedQuery</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/tweets/index/hashtags_bin/ri/ru?max_results=5&amp;return_terms=true
</code></pre>

<p>Here is an example JSON response (your client-specific response may differ):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"continuation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"g2gCbQAAAAdyaXBqYWtlbQAAABIzNDkyMjA2ODcwNTcxMjk0NzM="</span><span class="p">,</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"rice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349222574510710785"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"rickross"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349222868095217664"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"ridelife"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349221819552763905"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"ripjake"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349220649341952001"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"ripjake"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349220687057129473"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Take the continuation value from the previous result set and feed it
back into the query.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Namespace</span> <span class="n">tweetsBucket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"tweets"</span><span class="o">);</span>
<span class="nc">BinIndexQuery</span> <span class="n">biq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">tweetsBucket</span><span class="o">,</span> <span class="s">"hashtags"</span><span class="o">,</span> <span class="s">"ri"</span><span class="o">,</span> <span class="s">"ru"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withContinuation</span><span class="o">(</span><span class="nc">BinaryValue</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"g2gCbQAAAAdyaXBqYWtlbQAAABIzNDkyMjA2ODcwNTcxMjk0NzM"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">withMaxResults</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withKeyAndIndex</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">biq</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span>
  <span class="s1">'hashtags_bin'</span><span class="p">,</span>
  <span class="s1">'ri'</span><span class="o">..</span><span class="s1">'ru'</span><span class="p">,</span>
  <span class="ss">continuation: </span><span class="s1">'g2gCbQAAAAdyaXBqYWtlbQAAABIzNDkyMjA2ODcwNTcxMjk0NzM'</span><span class="p">,</span>
  <span class="ss">max_results: </span><span class="mi">5</span><span class="p">,</span>
  <span class="ss">return_terms: </span><span class="kp">true</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">Basho\Riak\Command\Builder\QueryIndex</span><span class="p">(</span><span class="nv">$riak</span><span class="p">))</span>
  <span class="o">-&gt;</span><span class="nf">buildBucket</span><span class="p">(</span><span class="s1">'tweets'</span><span class="p">,</span> <span class="s1">'indexes'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withIndexName</span><span class="p">(</span><span class="s1">'hashtags'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withRangeValue</span><span class="p">(</span><span class="s1">'ri'</span><span class="p">,</span> <span class="s1">'ru'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withMaxResults</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">withContinuation</span><span class="p">(</span><span class="s1">'g2gCbQAAAAdyaXBqYWtlbQAAABIzNDkyMjA2ODcwNTcxMjk0NzM'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">build</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getResults</span><span class="p">();</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'tweets'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="n">get_index</span><span class="p">(</span>
    <span class="s">'hashtags_bin'</span><span class="p">,</span>
    <span class="s">'ri'</span><span class="p">,</span> <span class="s">'ru'</span><span class="p">,</span>
    <span class="n">continuation</span><span class="o">=</span><span class="s">'g2gCbQAAAAdyaXBqYWtlbQAAABIzNDkyMjA2ODcwNTcxMjk0NzM'</span><span class="p">,</span>
    <span class="n">max_results</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">return_terms</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// rslt is the previous 2i fetch result</span>
<span class="kt">var</span> <span class="n">idxId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"tweets"</span><span class="p">,</span> <span class="s">"hashtags"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexGetOptions</span><span class="p">();</span>
<span class="n">options</span><span class="p">.</span><span class="nf">SetMaxResults</span><span class="p">(</span><span class="m">5</span><span class="p">);</span>
<span class="n">options</span><span class="p">.</span><span class="nf">SetContinuation</span><span class="p">(</span><span class="n">rslt</span><span class="p">.</span><span class="n">Continuation</span><span class="p">);</span>
<span class="n">rslt</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetSecondaryIndex</span><span class="p">(</span><span class="n">idxId</span><span class="p">,</span> <span class="s">"ri"</span><span class="p">,</span> <span class="s">"ru"</span><span class="p">,</span> <span class="n">options</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// See above example</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Results</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index_range</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"tweets"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"hashtags"</span><span class="p">},</span> <span class="c">%% index name
</span>    <span class="o">&lt;&lt;</span><span class="s">"ri"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"ru"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="c">%% range query from "ri" to "ru"
</span>    <span class="p">[</span>
        <span class="p">{</span><span class="n">continuation</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"g2gCbQAAAAdyaXBqYWtlbQAAABIzNDkyMjA2ODcwNTcxMjk0NzM"</span><span class="o">&gt;&gt;</span><span class="p">},</span>
        <span class="p">{</span><span class="n">max_results</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>
        <span class="p">{</span><span class="n">return_terms</span><span class="p">,</span> <span class="n">true</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// See above example</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/tweets/index/hashtags_bin/ri/ru?continuation=g2gCbQAAAAdyaXBqYWtlbQAAABIzNDkyMjA2ODcwNTcxMjk0NzM=&amp;max_results=5&amp;return_terms=true
</code></pre>

<p>The result:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"continuation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"g2gCbQAAAAlyb2Jhc2VyaWFtAAAAEjM0OTIyMzcwMjc2NTkxMjA2NQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ripjake"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349221198774808579"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ripped"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349224017347100672"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"roadtrip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349221207155032066"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"roastietime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349221370724491265"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"robaseria"</span><span class="p">:</span><span class="w"> </span><span class="s2">"349223702765912065"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="streaming">Streaming</h3>

<p>It is also possible to stream results:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Available in Riak Java Client 2.1.0 and later</span>
<span class="kt">int</span> <span class="n">pollTimeoutMS</span> <span class="o">=</span> <span class="mi">200</span><span class="o">;</span>
<span class="nc">Namespace</span> <span class="n">ns</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Namespace</span><span class="o">(</span><span class="s">"indexes"</span><span class="o">,</span> <span class="s">"tweets"</span><span class="o">);</span>
<span class="nc">String</span> <span class="n">indexName</span> <span class="o">=</span> <span class="s">"hashtags"</span><span class="o">;</span>

<span class="nc">BinIndexQuery</span> <span class="n">indexQuery</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">ns</span><span class="o">,</span> <span class="n">indexName</span><span class="o">,</span> <span class="s">"ri"</span><span class="o">,</span> <span class="s">"ru"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

<span class="kd">final</span> <span class="nc">RiakFuture</span><span class="o">&lt;</span><span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">StreamingResponse</span><span class="o">,</span> <span class="nc">BinIndexQuery</span><span class="o">&gt;</span> <span class="n">streamingFuture</span> <span class="o">=</span>
    <span class="n">client</span><span class="o">.</span><span class="na">executeAsyncStreaming</span><span class="o">(</span><span class="n">indexQuery</span><span class="o">,</span> <span class="n">pollTimeoutMS</span><span class="o">);</span>

<span class="c1">// For streaming commands, the future's value will be available before</span>
<span class="c1">// the future is complete, so you may begin to pull results from the</span>
<span class="c1">// provided iterator as soon as possible.</span>
<span class="kd">final</span> <span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">StreamingResponse</span> <span class="n">streamingResponse</span> <span class="o">=</span> <span class="n">streamingFuture</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">BinIndexQuery</span><span class="o">.</span><span class="na">Response</span><span class="o">.</span><span class="na">Entry</span> <span class="n">e</span> <span class="o">:</span> <span class="n">streamingResponse</span><span class="o">)</span>
<span class="o">{</span>
    <span class="c1">// Do something with key...</span>
<span class="o">}</span>

<span class="n">streamingFuture</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
<span class="nc">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">streamingFuture</span><span class="o">.</span><span class="na">isDone</span><span class="o">());</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">bucket_type</span><span class="p">(</span><span class="s1">'indexes'</span><span class="p">).</span><span class="nf">bucket</span><span class="p">(</span><span class="s1">'people'</span><span class="p">)</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">get_index</span><span class="p">(</span><span class="s1">'myindex_bin'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="ss">stream: </span><span class="kp">true</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
  It is not currently possible to stream results using the PHP client
*/</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s">'indexes'</span><span class="p">).</span><span class="n">bucket</span><span class="p">(</span><span class="s">'people'</span><span class="p">)</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">bucket</span><span class="p">.</span><span class="n">stream_index</span><span class="p">(</span><span class="s">'myindex_bin'</span><span class="p">,</span> <span class="s">'foo'</span><span class="p">):</span>
    <span class="n">keys</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">riakIndexId</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RiakIndexId</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">,</span> <span class="s">"tweets"</span><span class="p">,</span> <span class="s">"hashtags"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexRiakResult</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">StreamGetSecondaryIndex</span><span class="p">(</span><span class="n">riakIndexId</span><span class="p">,</span> <span class="s">"ri"</span><span class="p">,</span> <span class="s">"ru"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">indexResult</span> <span class="p">=</span> <span class="n">indexRiakResult</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">key</span> <span class="k">in</span> <span class="n">indexResult</span><span class="p">.</span><span class="n">IndexKeyTerms</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Do something with key...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">binIdxCmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Riak</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">KV</span><span class="p">.</span><span class="nx">SecondaryIndexQuery</span><span class="p">.</span><span class="nx">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">withBucketType</span><span class="p">(</span><span class="dl">'</span><span class="s1">indexes</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withBucket</span><span class="p">(</span><span class="dl">'</span><span class="s1">tweets</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withIndexName</span><span class="p">(</span><span class="dl">'</span><span class="s1">hashtags_bin</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withRange</span><span class="p">(</span><span class="dl">'</span><span class="s1">ri</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ru</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withStreaming</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">.</span><span class="nx">withCallback</span><span class="p">(</span><span class="nx">query_cb</span><span class="p">)</span> <span class="c1">// See query_cb in other examples</span>
    <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">binIdxCmd</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">KeyStream</span><span class="p">}</span> <span class="o">=</span> <span class="nn">riakc_pb_socket</span><span class="p">:</span><span class="nf">get_index_eq</span><span class="p">(</span>
    <span class="nv">Pid</span><span class="p">,</span>
    <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">"indexes"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="o">&lt;&lt;</span><span class="s">"people"</span><span class="o">&gt;&gt;</span><span class="p">},</span> <span class="c">%% bucket type and bucket name
</span>    <span class="p">{</span><span class="n">binary_index</span><span class="p">,</span> <span class="s">"myindex"</span><span class="p">},</span> <span class="c">%% index name and type
</span>    <span class="o">&lt;&lt;</span><span class="s">"foo"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="c">%% value of the index
</span>    <span class="p">[{</span><span class="n">stream</span><span class="p">,</span> <span class="n">true</span><span class="p">}]</span> <span class="c">%% enable streaming
</span><span class="p">).</span>
</code></pre></div></div>

<div class="language-golang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">riak</span><span class="o">.</span><span class="n">NewSecondaryIndexQueryCommandBuilder</span><span class="p">()</span><span class="o">.</span>
    <span class="n">WithBucketType</span><span class="p">(</span><span class="s">"indexes"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithBucket</span><span class="p">(</span><span class="s">"tweets"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithIndexName</span><span class="p">(</span><span class="s">"hashtags_bin"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithRange</span><span class="p">(</span><span class="s">"ri"</span><span class="p">,</span> <span class="s">"ru"</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithStreaming</span><span class="p">(</span><span class="no">true</span><span class="p">)</span><span class="o">.</span>
    <span class="n">WithCallback</span><span class="p">(</span><span class="n">streamingCallback</span><span class="p">)</span><span class="o">.</span>
    <span class="n">Build</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/people/index/myindex_bin/foo?stream=true
</code></pre>

<p>Streaming can also be combined with <code class="language-plaintext highlighter-rouge">pagination</code> and <code class="language-plaintext highlighter-rouge">return_terms</code>.</p>

<h3 id="sorting">Sorting</h3>

<p>As of Riak 1.4, the result set is sorted on index values (when executing
range queries) and object keys. See the pagination example above: hash
tags (2i keys) are returned in ascending order, and the object keys
(Twitter IDs) for the messages which contain the <code class="language-plaintext highlighter-rouge">ripjake</code> hash tag are
also returned in ascending order.</p>

<h3 id="retrieve-all-bucket-keys-via-the-bucket-index">Retrieve all Bucket Keys via the <code class="language-plaintext highlighter-rouge">$bucket</code> Index</h3>

<p>The following example retrieves the keys for all objects stored in the
bucket <code class="language-plaintext highlighter-rouge">people</code> using an exact match on the special <code class="language-plaintext highlighter-rouge">$bucket</code> index.</p>

<pre><code class="language-curl">curl localhost:8098/types/indexes/buckets/people/index/\$bucket/_
</code></pre>

<h3 id="count-bucket-objects-via-bucket-index">Count Bucket Objects via $bucket Index</h3>

<p>The following example performs a secondary index lookup on the $bucket
index like in the previous example and pipes this into a MapReduce that
counts the number of records in the <code class="language-plaintext highlighter-rouge">people</code> bucket. In order to
improve efficiency, the batch size has been increased from the default
size of 20.</p>

<pre><code class="language-curl">curl -XPOST localhost:8098/mapred\
  -H "Content-Type: application/json" \
  -d @-&lt;&lt;EOF
{
  "inputs": {
    "bucket": "people",
    "index": "\$bucket",
    "key":"people"
  },
  "query": [
    {
      "reduce": {
        "language": "erlang",
        "module": "riak_kv_mapreduce",
        "function": "reduce_count_inputs",
        "arg": {
          "reduce_phase_batch_size":1000
        }
      }
    }
  ]
}
EOF
</code></pre>
